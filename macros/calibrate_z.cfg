[gcode_macro CALIBRATE_Z]
rename_existing: BASE_CALIBRATE_Z
gcode:
    {% set bed_position = params.BED_POSITION|default('None') %}
    CG28
    M117 Z-Calibration..
    ATTACH_PROBE                # a macro for fetching the probe first
    {% if bed_position != 'None' %}
      BASE_CALIBRATE_Z BED_POSITION={bed_position}
    {% else %}
      BASE_CALIBRATE_Z
    {% endif %}
    DOCK_PROBE_UNLOCK               # and parking it afterwards (or DOCK_PROBE in klicky macros)
    M117

[gcode_macro ATTACH_PROBE_TEST]
gcode:
      {% set F = 4000 %}   
      SAVE_GCODE_STATE NAME=attach_probe_state
      T1
      G90
      G0 Z14
      G0 Y60 F{F}
      G0 X60 Y60 F{F}
      G0 X-36 Y100 F{F}
      G0 Y118.5 F{F}
      G0 X-16 F{F}
      G0 X60 Y60 F{F}
      RESTORE_GCODE_STATE NAME=attach_probe_state